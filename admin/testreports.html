<div>
	<table cellpadding="0" cellspacing="0" border="0" class="display" id="testreports-table">
	</table>
</div>

<script type="text/javascript">

var test_table;
var testreports;

function drawResultIcons(nRow, aData, iDisplayIndex)
{
	job_det = aData[0].split(',');
	job_info =
		'<a href=\"' + job_det[2] + '\">' + job_det[0] +
		'<br/>' + job_det[1] + '</a>';
	$('td:eq(0)', nRow).html(job_info);

	for (i = 1; i < aData.length; i++)
	{
		var result_icons = "";
		row_det = aData[i].split('|');

		if (row_det.length > 0 && row_det[0].length > 0) {
			for (j = 0; j < row_det.length; j++) {
				result_icons += drawResultIcon(row_det[j]);
			}
		}

		if (result_icons == "undefined")
			result_icons = "";

		$('td:eq(' + i + ')', nRow).html(result_icons);
	}
	
	return nRow;
}

function drawResultIcon(details)
{
	var result_status;
	var det = details.split(',');
	var engine = det[0];
	var status = det[2];
	var fail = det[3];
	var error = det[4];
	var total = det[5];
	var run_id = det[6];
	var client_id = det[7];
	var summary;

	if ( status == 0 ) {
		result_status = "none";
	} else if ( status == 1 ) {
		result_status = "inprogress";
	} else if ( status == 2 && fail == -1 ) {
		result_status = "timeout";
		summary = '...';
	} else if ( status == 2 && (error > 0 || total == 0) ) {
		result_status = "error";
		if (error > 0)
			summary = error;
		else
			summary = 0;
	} else {
		if (fail > 0) {
			result_status = "failure";
			summary = fail;
		} else {
			result_status = "success";
			summary = total;
		}
	}
	
	if (result_status != "success" && result_status != "failure"
		&& result_status != "timeout" && result_status != "error") {
		return;
	}

	var result_icon =
		'<a class="result-link" href=\"../index.php?state=runresults&run_id=' +
		run_id + '&client_id=' + client_id + '\" ' +
		'<div class=\"result-icon\">' +
		'<img src=\"../images/os/' + engine + '.sm.png\"/>' +
		'<span class=\"' + result_status + '\">' + summary +
		'</span></div></a>';

	return result_icon;
}

function initTestTable(response)
{
	table_head = "<tr><th width=\"300px\">Job</th>";
	$.each(response.engine, function(i, engine) {
		table_head += "<th><img src=\"../images/" + engine + ".sm.png\"></th>";
	});
	table_head += "</tr>";

	table_body = "<tr><td></td>";
	$.each(response.engine, function(i, engine) {
		table_body += "<td></td>";
	});
	table_body += "</tr>";

	table_foot = table_head;

	test_table =
		"<thead>" +
		table_head +
		"</thead>" +
		"<tbody>" +
		table_body +
		"</tbody>" +
		"<tfoot>" +
		table_foot +
		"</tfoot>";

	$(test_table).appendTo('#testreports-table');

	testreports = $('#testreports-table').dataTable({
		"bProcessing": true,
		"sAjaxSource": 'admin.php?action=testresults',
		"fnRowCallback": drawResultIcons
	});
}

$(document).ready(function() {

	getData({"action":"testengines"}, initTestTable, {"type":"post"});

});

</script>