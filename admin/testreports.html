<div>
	<table cellpadding="0" cellspacing="0" border="0" class="display" id="testreports-table">
	</table>
</div>

<script type="text/javascript">

var test_table;
var testreports;

function drawResultIcons(nRow, aData, iDisplayIndex)
{
	job_det = aData[0].split(',');
	job_info =
		'<a href=\"' + job_det[2] + '\">' + job_det[0] +
		'<br/>' + job_det[1] + '</a>';
	$('td:eq(0)', nRow).html(job_info);

	for (i = 1; i < aData.length; i++)
	{
		var result_icons = "";
		row_det = aData[i].split('|');

		if (row_det.length > 0 && row_det[0].length > 0) {
			for (j = 0; j < row_det.length; j++) {
				result_icons += drawResultIcon(row_det[j]);
			}
		}

		if (result_icons == "undefined")
			result_icons = "";

		$('td:eq(' + i + ')', nRow).html(result_icons);
	}
	
	return nRow;
}

function drawResultIcon(details)
{
	var result_status;
	var det = details.split(',');

	if ( det[2] == 0 ) {
		result_status = "none";
	} else if ( det[2] == 1 ) {
		result_status = "inprogress";
	} else if ( det[2] == 2 && det[3] == -1 ) {
		result_status = "timeout";
		det[5] = 0;
	} else if ( det[2] == 2 && (det[4] > 0 || det[5] == 0) ) {
		result_status = "error";
	} else {
		if (det[3] > 0) {
			result_status = "failure"
		} else {
			result_status = "success";
		}
	}
	
	if (result_status != "success" && result_status != "failure"
		&& result_status != "timeout" && result_status != "error") {
		return;
	}

	var result_icon =
		'<a class="result-link" href=\"../index.php?state=runresults&run_id=' +
		det[6] + '&client_id=' + det[7] + '\" ' +
		'<div class=\"result-icon\">' +
		'<img src=\"../images/os/' + det[0] + '.sm.png\"/>' +
		'<span class=\"' + result_status + '\">' + det[5] +
		'</span></div></a>';

	return result_icon;
}

function initTestTable(response)
{
	table_head = "<tr><th width=\"300px\">Job</th>";
	$.each(response.engine, function(i, engine) {
		table_head += "<th><img src=\"../images/" + engine + ".sm.png\"></th>";
	});
	table_head += "</tr>";

	table_body = "<tr><td></td>";
	$.each(response.engine, function(i, engine) {
		table_body += "<td></td>";
	});
	table_body += "</tr>";

	table_foot = table_head;

	test_table =
		"<thead>" +
		table_head +
		"</thead>" +
		"<tbody>" +
		table_body +
		"</tbody>" +
		"<tfoot>" +
		table_foot +
		"</tfoot>";

	$(test_table).appendTo('#testreports-table');

	testreports = $('#testreports-table').dataTable({
		"bProcessing": true,
		"sAjaxSource": 'admin.php?action=testresults',
		"fnRowCallback": drawResultIcons
	});
}

$(document).ready(function() {

	getData({"action":"testengines"}, initTestTable, {"type":"post"});

});

</script>